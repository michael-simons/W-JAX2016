<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<title>Spring Boot Starter- Komfortable Modularisierung und Konfiguration(en)</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}
* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>

<style type="text/css">
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #a67f59;
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
</style>


</head>

<body>

<h1 id="toc_0">Spring Boot Starter: Comfortable modularization and abstraction</h1>

<h2 id="toc_1">Abstract</h2>

<p>Even in the light of microservices good architecture and well thought modularization is vital for all kinds of application. A microservice without inner structure is as bad maintainable as an old-fashioned monolith, maybe even worse. Candidates for external modules that are intrinsic parts of many microservices without being one of their own could be:</p>

<ul>
<li>Datastructures (entities) and corresponding data access objects or repositories for recurrent, structured information</li>
<li>Logging, status (healthchecks) and similar, cross-cutting or other non-functional requirements, which are paramount to manage the growing number of services</li>
<li>Integrations (for databases, caches and many others)</li>
</ul>

<p>Those modules must not only be provided but also be configured, but often this configuration can be an opinionated configuration using sensible defaults which reduces manual configuration in many cases by magnitudes.</p>

<p>In this article i will show you how to create custom &quot;Starters&quot; for Spring Boot based applications that provide opinionated configuration, custom functionality and more.</p>

<h3 id="toc_2">Spring Boot</h3>

<p><a href="http://projects.spring.io/spring-boot/">Spring Boot</a> can be seen as an umbrella project for the Spring eco-system that has been created with the following goals in mind:</p>

<ul>
<li>To provide a radically faster and widely accessible ‘getting started’ experience for all <a href="https://projects.spring.io/spring-framework/">Spring</a> development</li>
<li>To be opinionated out of the box, but get out of the way quickly as requirements start to diverge from the defaults</li>
<li>To provide a range of non-functional features that are common to large classes of projects (e.g. embedded servers, security, metrics, health checks, externalized configuration)</li>
</ul>

<p>Spring Boot does not generate code during bootstrapping or during runtime and there is absolutely no requirement for XML configuration. All tools that are used by Spring Boot to detect available libraries, environment and configuration are available outside Spring Boot for the creation of custom configuration classes or whole &quot;Starters&quot;.</p>

<h3 id="toc_3">The use case: Manage your JavaScript dependencies with Maven, Webjars und wro4j</h3>

<p>Rumor has it, that there&#39;s still a need for server-side generated HTML code, JavaScript as progressive enhancement und simple management of JavaScript dependencies without the the need to use the &quot;Universal install script&quot;, even in 2016:</p>

<p><img src="/img/universal_install_script.png" alt="The universal install script"></p>

<p>We all have been cursed about Maven, but fact is: It works most of the time unobtrusive and it is also pretty good in managing dependencies, resolve them and find conflicting versions (for example using the <em>enforcer-plugin</em>).</p>

<p><a href="http://www.webjars.org/">WebJars</a> is a project by <a href="https://twitter.com/_JamesWard">James Ward</a> and facilitates the explicit and easy management of the client-side dependencies in JVM-based web applications through Maven, SBT, Gradle, ivy or other build tools. Spring Boot supports WebJars out of the box and dependencies can be used like this:</p>

<div><pre><code class="language-markup">&lt;link rel=&#39;stylesheet&#39; href=&#39;/webjars/bootstrap/3.1.0/css/bootstrap.min.css&#39;&gt;</code></pre></div>

<p><a href="http://alexo.github.io/wro4j/">wro4j</a> is a tool for analyzing and optimizing web resources that combines many modern tools from frontend development.</p>

<p>The goal is to express frontend dependencies inside the <code>pom.xml</code>:</p>

<div><pre><code class="language-markup">&lt;properties&gt;
    &lt;jquery.version&gt;1.11.3&lt;/jquery.version&gt;
    &lt;angularjs.version&gt;1.2.29&lt;/angularjs.version&gt;
&lt;/properties&gt;
&lt;!-- ... --&gt;
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.webjars&lt;/groupId&gt;
        &lt;artifactId&gt;jquery&lt;/artifactId&gt;
        &lt;version&gt;${jquery.version}&lt;/version&gt;
    &lt;/dependency&gt;   
    &lt;dependency&gt;
        &lt;groupId&gt;org.webjars&lt;/groupId&gt;
        &lt;artifactId&gt;angularjs&lt;/artifactId&gt;
        &lt;version&gt;${angularjs.version}&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;     </code></pre></div>

<p>and to combine those dependencies into logical modules. The following example shows a library group that is combined with custom JavaScript code into one module:</p>

<div><pre><code class="language-markup">&lt;groups xmlns=&quot;http://www.isdc.ro/wro&quot;&gt;
    &lt;group name=&quot;lib&quot;&gt;
        &lt;js minimize=&quot;false&quot;&gt;/webjars/jquery/@jquery.version@/jquery.min.js&lt;/js&gt;
        &lt;js minimize=&quot;false&quot;&gt;/webjars/angularjs/@angularjs.version@/angular.min.js&lt;/js&gt;
        &lt;js minimize=&quot;false&quot;&gt;/webjars/angularjs/@angularjs.version@/angular-route.min.js&lt;/js&gt;
    &lt;/group&gt;

    &lt;group name=&quot;biking2&quot;&gt;
        &lt;group-ref&gt;lib&lt;/group-ref&gt;

        &lt;css&gt;/css/stylesheet.css&lt;/css&gt;

        &lt;js&gt;/js/app.js&lt;/js&gt;
        &lt;js&gt;/js/controllers.js&lt;/js&gt;
        &lt;js&gt;/js/directives.js&lt;/js&gt;
    &lt;/group&gt;
&lt;/group&gt;</code></pre></div>

<p>We&#39;re using the Xml configuration of Wro4j but there&#39;s also a nice Groovy DSL available.</p>

<p>This necessary configuration of what is to be used combined with the starter should be enough to include <em>jQuery</em>, <em>AngularJS</em> and custom functionality through one single HTML element.</p>

<h2 id="toc_4">Spring Boot Starter</h2>

<p>A Spring Boot starter consists of two components:</p>

<ul>
<li>One <code>autoconfigure</code> module containing the automatic configuration including it&#39;s default values.</li>
<li>The <code>starter</code> module itself, providing the dependency to the <code>autoconfigure</code> module and all needed additional dependencies</li>
</ul>

<p>Including the <code>starter</code> as a dependency for a Spring Boot application should be enough to start using that library. If a separation of those two isn&#39;t needed, combine everything into the <code>starter</code> module.</p>

<h3 id="toc_5">Not a kind of magic: Conditions</h3>

<p>Pivotals <em>Spring Developer Advocate</em> <a href="https://twitter.com/starbuxman/status/708579187087511552">Josh Long</a> explicitly opposes calling auto configuration inside Spring Boot applications &quot;magic&quot; and he is right saying so.</p>

<p>The environments automatic configuration is based on two core components:</p>

<ul>
<li>Profiles (<code>@Profile</code>, available since Spring 3.1) and</li>
<li>Conditions (<code>@Conditional</code> together with <code>org.springframework.context.annotation.Condition</code>, available since Spring 4)</li>
</ul>

<p>Profiles allow provisioning of Beans based on active profiles (<code>spring.profiles.active</code>), whereas conditions can be used to model simple to complex conditions under which Beans are instantiated and configured:</p>

<ul>
<li><code>@Conditional</code> from the core framework allows with a custom implementation of a <code>Condition</code> arbitrary statements</li>
</ul>

<p>Spring Boot contains several useful implementations</p>

<ul>
<li><code>@ConditionalOnBean</code> / <code>@ConditionalOnMissingBean</code>: Configuration and beans are only instantiated and used when certain other Beans are available or missing</li>
<li><code>@ConditionalOnClass</code> / <code>@ConditionalOnMissingClass</code>: Configuration and beans are only instantiated and used when certain classes are available to the classloader</li>
<li><code>@ConditionalOnResource</code> is triggered only when specific resources are available</li>
<li><code>@ConditionalOnProperty</code>: A really powerful condition that matches concrete properties inside configurational files</li>
</ul>

<p>As much the automatic configuration of Spring Boot applications and their adaption to environment seems magical, it doesn&#39;t fit Clarke&#39;s third law. It&#39;s all there to see and use. Spring Boot even provides a <a href="http://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/autoconfigure/condition/ConditionEvaluationReport.html">ConditionEvaluationReport</a>, that allows exactly to understand, why a  configuration in a given order took place.</p>

<p>And by the way: Spring uses it&#39;s own features: The <code>@Profile</code> annotation has been rewritten for Spring 4 and is based on <em>Conditions</em> itself.</p>

<h3 id="toc_6">Example: Providing the Wro4j Servlet filter</h3>

<p>Wro4js core is basically the Servlet filter mapped to an URL pattern which processes the requests for CSS and JavaScript files configured in <code>wro.xml</code> or <code>wro.groovy</code>. This filter should be added the the servlet registration without manual interaction by just adding the <code>wro4j-spring-boot-starter</code> dependency:</p>

<div><pre><code class="language-java">@Configuration
@ConditionalOnClass(WroFilter.class)
@ConditionalOnMissingBean(WroFilter.class)
@EnableConfigurationProperties(Wro4jProperties.class)
@AutoConfigureAfter(CacheAutoConfiguration.class)
public class Wro4jAutoConfiguration {
}

@ConfigurationProperties(&quot;wro4j&quot;)
public class Wro4jProperties {
}</code></pre></div>

<p><code>Wro4jAutoConfiguration</code> is a common  Spring <code>@Configuration</code> class (classes which use programmatically instantiate, configure and provide Beans). The configuration - all methods annotated with <code>@Bean</code> among others - should only be done if the <code>WroFilter</code> class is available and there isn&#39;t a bean of that type yet. Configuration should be done after the automatic cache configuration as this will be used later. This class also provides properties starting with &quot;wro4j.*&quot; inside an object, in an instance of <code>Wro4jProperties</code>.</p>

<p>There&#39;s a caveat here: Often you create configuration for a possible starter inside the project that&#39;s using the starter first. That works fine (as by default all <code>@Configuration</code> classes under the base package are evaluated) until the classes building that starter are extracted from the project and you forget to add a <code>META-INF/spring.factories</code>. This file is very similar to the Java &quot;Service Provider Interfaces&quot; and contains the list of classes that should take part in autoconfiguration:</p>

<div><pre><code class="language-none">org.springframework.boot.autoconfigure.EnableAutoConfiguration = ac.simons.spring.boot.wro4j.Wro4jAutoConfiguration</code></pre></div>

<p>With this file Spring Boot neither doesn&#39;t have to scan the whole classpath for starter nor the user must take additional steps besides adding the starter itself.</p>

<p>Back to the example. The Servlet filter is a regular Spring Bean and is created like this inside <code>Wro4jAutoConfiguration</code>:</p>

<div><pre><code class="language-java">@Bean
ConfigurableWroFilter wroFilter(WroManagerFactory wroManagerFactory, Wro4jProperties wro4jProperties) {
    ConfigurableWroFilter wroFilter = new ConfigurableWroFilter();
    wroFilter.setProperties(wroFilterProperties(wro4jProperties));
    wroFilter.setWroManagerFactory(wroManagerFactory);
    return wroFilter;
}</code></pre></div>

<p>As you can see: The filter depends on a <code>WroManagerFactory</code> and other properties which are injected as usual into this method.</p>

<p>This example shows how powerful the code based configuration of Spring Beans is: Complex conditions and configuration are right their in the source and can be understood, debugged and more, with or without tooling support by IDEs.</p>

<h3 id="toc_7">Example: Different environment</h3>

<p>Wro4j supports caching of optimized resources through a simple, memory-based <em>Least Recently Used</em> strategy. The strategy is an interface and an implementation of a new <code>CacheStrategy</code> using the built-in <code>org.springframework.cache.CacheManager</code> is easily done. To make it work there must be an instance of Springs CacheManager. To get one, use <code>@EnableCaching</code> for example. As Spring supports several caches, ehcache, Redis and others, you get either get a manager backed by either one of those.</p>

<p>Otherwise, if there&#39;s no cache manager, the starter should use the basic Wro4j strategy that certainly doesn&#39;t make use of any Spring features:</p>

<div><pre><code class="language-java">@Bean
@ConditionalOnBean(CacheManager.class)
@ConditionalOnProperty(&quot;wro4j.cacheName&quot;)
@ConditionalOnMissingBean(CacheStrategy.class)
@Order(-100)
&lt;K, V&gt; CacheStrategy&lt;K, V&gt; springCacheStrategy(CacheManager cacheManager, Wro4jProperties wro4jProperties) {
    return new SpringCacheStrategy&lt;K, V&gt;(cacheManager, wro4jProperties.getCacheName());
}

@Bean
@ConditionalOnMissingBean(CacheStrategy.class)
@Order(-90)
&lt;K, V&gt; CacheStrategy&lt;K, V&gt; defaultCacheStrategy() {
    return new LruMemoryCacheStrategy&lt;K, V&gt;();
}</code></pre></div>

<p>The <code>springCacheStrategy</code> method is only executed if a <code>CacheManager</code> is active, the name for the actual cache is configured and there isn&#39;t a cache strategy already defined. By using an additional <code>@Order</code> annotation its ensured that this method is evaluated before <code>defaultCacheStrategy</code>, which instantiates the default Wro4j strategy.</p>

<p>There are certainly people who would add this exampel to <a href="http://www.annotatiomania.com">@Annotatiomania™</a> in no time, but I think using this combination of annotations and code for conditions and configuration apart from business logic and objects is an appropriate and actually readable way.</p>

<h3 id="toc_8">Deployment</h3>

<p>The example project is a standard Maven project, combining a shared <code>autoconfigure</code> and <code>starter</code> module. As such, it bundles the implementation of autoconfiguration as well as the dependencies to Wroj4:</p>

<div><pre><code class="language-markup">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;ro.isdc.wro4j&lt;/groupId&gt;
        &lt;artifactId&gt;wro4j-core&lt;/artifactId&gt;
        &lt;version&gt;${wro4j.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;       
&lt;/dependencies&gt;</code></pre></div>

<p>The dependencies of the <code>autoconfigure</code> module are usually marked as <em>optional</em> and only finalized in the <code>starter</code> module when creating two separate projects.</p>

<p>There&#39;s one peculiarity of the starter presented here: It&#39;s a child artifact of the official <em>spring-boot-starters</em> parent project. I thought it would be a nice training for clean code and good coding guidelines learning from the settings the Spring team uses. But, as i heard, they only want to <a href="https://twitter.com/ankinson/status/693744796633006082">inflict them</a> on themselves. What made my life easier was my preferred <a href="http://www.netbeans.org">IDE</a>, which supports Checkstyle, JaCoCo and others out of the box.</p>

<p>The project is available on <a href="https://github.com/michael-simons/wro4j-spring-boot-starter">GitHub</a>.</p>

<h3 id="toc_9">Conclusion</h3>

<p>The starter described here is in production in several projects in our company as well as in public, for example at the <a href="http://www.euregjug.eu">Euregio JUG</a>. It saved us from manually managing dependencies and copy and pasting recurring configuration.</p>

<p>There are few alternatives to  Spring Boot Starters when developing shared modules for Spring Boot based applications. You could use annotation based configuration for them (<code>@Service</code> and the like) but than you&#39;d have to trigger classpath scanning on a broader level. Manually writing additional XML or Java based configuration seems tedious and may lead to errors.</p>

<p>There are many useful starters listed in the <a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-starters">spring-boot-starters</a>-repository: Be it database integration, support for various template engines or even remote shells.</p>

<p>The goal of providing a starter for Wro4j was reached. You have to add the starter and a <em>wro.xml</em> like above containing Maven placeholders like  <code>@jquery.version@</code>, which are also used for the WebJar dependencies and processed by the Maven resource plugin:</p>

<div><pre><code class="language-markup">&lt;resources&gt;
   &lt;resource&gt;
        &lt;directory&gt;src/main/resources&lt;/directory&gt;
        &lt;filtering&gt;true&lt;/filtering&gt;
        &lt;includes&gt;
            &lt;include&gt;wro.xml&lt;/include&gt;
        &lt;/includes&gt;
    &lt;/resource&gt;
&lt;/resources&gt;</code></pre></div>

<p>You are free to configure the Wro4j processors and url inside <code>application.properties</code>:</p>

<div><pre><code class="language-none">wro4j.filterUrl = /owr
wro4j.managerFactory.preProcessors = removeSourceMaps, cssUrlRewriting, cssImport, cssMinJawr, semicolonAppender, jsMin
wro4j.cacheName = wro4j</code></pre></div>

<p>and as a result you&#39;ll get minimized CSS and JavaScript resources that can be included with a single statement in your HTML pages.</p>

<h3 id="toc_10">Outlook</h3>

<p>The starter here can be extended by creating custom <a href="http://thymeleaf.org">Thymeleaf</a> elements that either render one single HTML element or links to the original resources so that they can be easily debugged. The approach would be the same: Check if Thymeleaf is on the path, register additional tags and so on.</p>

<h2 id="toc_11">About the author</h2>

<p><img src="/img/michael-simons.jpg" alt="Michael Simons"></p>

<p>Michael Simons is a Software-Architect (CPSA-F) at <a href="http://www.enerko-informatik.de">ENERKO Informatik</a> in Aachen and working on GIS, EDM und sales management systems. Michael is cofounder of the <a href="http://www.euregjug.eu">Euregio JUG</a> and is blogging in regular intervals at <a href="http://info.michael-simons.eu">info.michael-simons.eu</a>.</p>

<h2 id="toc_12">Sources</h2>

<ul>
<li><a href="https://spring.io/blog/2013/08/06/spring-boot-simplifying-spring-for-everyone">The primary goals of Spring Boot</a></li>
<li><a href="http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-custom-starter">Creating your own starter</a></li>
<li><a href="http://xkcd.com/1654/">Universal install script</a></li>
<li><a href="http://maven.apache.org/enforcer/maven-enforcer-plugin/">Maven Enforcer Plugin - The Loving Iron Fist of Maven™</a> </li>
<li><a href="https://en.wikipedia.org/wiki/Clarke%27s_three_laws">Clarke&#39;s three laws</a></li>
</ul>



<script type="text/javascript">
var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,n=_self.Prism={util:{encode:function(e){return e instanceof a?new a(e.type,n.util.encode(e.content),e.alias):"Array"===n.util.type(e)?e.map(n.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){var t=n.util.type(e);switch(t){case"Object":var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=n.util.clone(e[r]));return a;case"Array":return e.map&&e.map(function(e){return n.util.clone(e)})}return e}},languages:{extend:function(e,t){var a=n.util.clone(n.languages[e]);for(var r in t)a[r]=t[r];return a},insertBefore:function(e,t,a,r){r=r||n.languages;var l=r[e];if(2==arguments.length){a=arguments[1];for(var i in a)a.hasOwnProperty(i)&&(l[i]=a[i]);return l}var o={};for(var s in l)if(l.hasOwnProperty(s)){if(s==t)for(var i in a)a.hasOwnProperty(i)&&(o[i]=a[i]);o[s]=l[s]}return n.languages.DFS(n.languages,function(t,n){n===r[e]&&t!=e&&(this[t]=o)}),r[e]=o},DFS:function(e,t,a,r){r=r||{};for(var l in e)e.hasOwnProperty(l)&&(t.call(e,l,e[l],a||l),"Object"!==n.util.type(e[l])||r[n.util.objId(e[l])]?"Array"!==n.util.type(e[l])||r[n.util.objId(e[l])]||(r[n.util.objId(e[l])]=!0,n.languages.DFS(e[l],t,l,r)):(r[n.util.objId(e[l])]=!0,n.languages.DFS(e[l],t,null,r)))}},plugins:{},highlightAll:function(e,t){var a={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",a);for(var r,l=a.elements||document.querySelectorAll(a.selector),i=0;r=l[i++];)n.highlightElement(r,e===!0,a.callback)},highlightElement:function(t,a,r){for(var l,i,o=t;o&&!e.test(o.className);)o=o.parentNode;o&&(l=(o.className.match(e)||[,""])[1],i=n.languages[l]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+l,o=t.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(e,"").replace(/\s+/g," ")+" language-"+l);var s=t.textContent,u={element:t,language:l,grammar:i,code:s};if(!s||!i)return n.hooks.run("complete",u),void 0;if(n.hooks.run("before-highlight",u),a&&_self.Worker){var c=new Worker(n.filename);c.onmessage=function(e){u.highlightedCode=e.data,n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(u.element),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},c.postMessage(JSON.stringify({language:u.language,code:u.code,immediateClose:!0}))}else u.highlightedCode=n.highlight(u.code,u.grammar,u.language),n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(t),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},highlight:function(e,t,r){var l=n.tokenize(e,t);return a.stringify(n.util.encode(l),r)},tokenize:function(e,t){var a=n.Token,r=[e],l=t.rest;if(l){for(var i in l)t[i]=l[i];delete t.rest}e:for(var i in t)if(t.hasOwnProperty(i)&&t[i]){var o=t[i];o="Array"===n.util.type(o)?o:[o];for(var s=0;s<o.length;++s){var u=o[s],c=u.inside,g=!!u.lookbehind,h=!!u.greedy,f=0,d=u.alias;u=u.pattern||u;for(var p=0;p<r.length;p++){var m=r[p];if(r.length>e.length)break e;if(!(m instanceof a)){u.lastIndex=0;var y=u.exec(m),v=1;if(!y&&h&&p!=r.length-1){var b=r[p+1].matchedStr||r[p+1],k=m+b;if(p<r.length-2&&(k+=r[p+2].matchedStr||r[p+2]),u.lastIndex=0,y=u.exec(k),!y)continue;var w=y.index+(g?y[1].length:0);if(w>=m.length)continue;var _=y.index+y[0].length,P=m.length+b.length;if(v=3,P>=_){if(r[p+1].greedy)continue;v=2,k=k.slice(0,P)}m=k}if(y){g&&(f=y[1].length);var w=y.index+f,y=y[0].slice(f),_=w+y.length,S=m.slice(0,w),O=m.slice(_),j=[p,v];S&&j.push(S);var A=new a(i,c?n.tokenize(y,c):y,d,y,h);j.push(A),O&&j.push(O),Array.prototype.splice.apply(r,j)}}}}}return r},hooks:{all:{},add:function(e,t){var a=n.hooks.all;a[e]=a[e]||[],a[e].push(t)},run:function(e,t){var a=n.hooks.all[e];if(a&&a.length)for(var r,l=0;r=a[l++];)r(t)}}},a=n.Token=function(e,t,n,a,r){this.type=e,this.content=t,this.alias=n,this.matchedStr=a||null,this.greedy=!!r};if(a.stringify=function(e,t,r){if("string"==typeof e)return e;if("Array"===n.util.type(e))return e.map(function(n){return a.stringify(n,t,e)}).join("");var l={type:e.type,content:a.stringify(e.content,t,r),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:r};if("comment"==l.type&&(l.attributes.spellcheck="true"),e.alias){var i="Array"===n.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(l.classes,i)}n.hooks.run("wrap",l);var o="";for(var s in l.attributes)o+=(o?" ":"")+s+'="'+(l.attributes[s]||"")+'"';return"<"+l.tag+' class="'+l.classes.join(" ")+'" '+o+">"+l.content+"</"+l.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",function(e){var t=JSON.parse(e.data),a=t.language,r=t.code,l=t.immediateClose;_self.postMessage(n.highlight(r,n.languages[a],a)),l&&_self.close()},!1),_self.Prism):_self.Prism;var r=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return r&&(n.filename=r.src,document.addEventListener&&!r.hasAttribute("data-manual")&&document.addEventListener("DOMContentLoaded",n.highlightAll)),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism);
</script>

<script type="text/javascript">
Prism.languages.markup={comment:/<!--[\w\W]*?-->/,prolog:/<\?[\w\W]+?\?>/,doctype:/<!DOCTYPE[\w\W]+?>/,cdata:/<!\[CDATA\[[\w\W]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=.$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\w\W])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/i,inside:{punctuation:/[=>"']/}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},Prism.hooks.add("wrap",function(a){"entity"===a.type&&(a.attributes.title=a.content.replace(/&amp;/,"&"))}),Prism.languages.xml=Prism.languages.markup,Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup;
</script>

<script type="text/javascript">
Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\w\W]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0}],string:{pattern:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,"boolean":/\b(true|false)\b/,"function":/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/};
</script>

<script type="text/javascript">
Prism.languages.java=Prism.languages.extend("clike",{keyword:/\b(abstract|continue|for|new|switch|assert|default|goto|package|synchronized|boolean|do|if|private|this|break|double|implements|protected|throw|byte|else|import|public|throws|case|enum|instanceof|return|transient|catch|extends|int|short|try|char|final|interface|static|void|class|finally|long|strictfp|volatile|const|float|native|super|while)\b/,number:/\b0b[01]+\b|\b0x[\da-f]*\.?[\da-fp\-]+\b|\b\d*\.?\d+(?:e[+-]?\d+)?[df]?\b/i,operator:{pattern:/(^|[^.])(?:\+[+=]?|-[-=]?|!=?|<<?=?|>>?>?=?|==?|&[&=]?|\|[|=]?|\*=?|\/=?|%=?|\^=?|[?:~])/m,lookbehind:!0}}),Prism.languages.insertBefore("java","function",{annotation:{alias:"punctuation",pattern:/(^|[^.])@\w+/,lookbehind:!0}});
</script>


</body>

</html>
